---
laout : single
title: "OpenCV 기능"
excerpt : "마스크, 시간측정, 다양한 함수"
categories :
- Computer Vision
tags :
- [Playdata , Python, OpenCV, Computer Vision]
toc: true #Table of contents 옆에 목록이 생성됨
toc_sticky: true #toc가 화면을 따라 내려옴
toc_label: 목차 #toc 상단에 써있는 제목

date: 2022-01-05
last_modified_at: 2022-01-05
---

## OpenCV 기능
### Mask 연산 1
```
In :  import cv2
      import sys
      import numpy as np
      src = cv2.imread('./data/lenna.bmp',cv2.IMREAD_COLOR)
      mask = cv2.imread('./data/mask_smile.bmp',cv2.IMREAD_GRAYSCALE)

      if src is None or mask is None:
          print("image load failed ! ")
          sys.exit()

      # 마스크 이미지가 하얀부분(255)는 노란색 RGB로 채우
      src[mask>0] = (0, 255, 255)
      cv2.imshow('src',src)
      cv2.imshow('mask',mask)

      cv2.waitKey()
      cv2.destroyAllWindows()
```

<div style="text-align:center;">
<img src="/assets/post_photo/opencv/220104_lenna1.jpg" width="40%">
<img src="/assets/post_photo/opencv/220106_mask2.jpg" width="40%">
<br />
<b> 원본 이미지들
<br />
<img src="/assets/post_photo/opencv/220106_mask1.jpg" width="50%">
<br />
마스크 씌우기</b>
</div>

### Mask 연산 2
```
In :  src = cv2.imread('./data/airplane.bmp',cv2.IMREAD_COLOR)
      mask = cv2.imread('./data/mask_plane.bmp',cv2.IMREAD_GRAYSCALE)
      dst = cv2.imread('./data/field.bmp',cv2.IMREAD_COLOR)

      if src is None or mask is None or dst is None:
          print("image load failed ! ",cv2.IMREAD_COLOR)
          sys.exit()

      dst[mask>0]=src[mask>0]

      cv2.imshow('dst1',dst)

      cv2.waitKey()
      cv2.destroyAllWindows()
```
<div style="text-align:center;">
<img src="/assets/post_photo/opencv/220106_plane1.jpg" width="30%">
<img src="/assets/post_photo/opencv/220106_planemask1.jpg" width="30%">
<img src="/assets/post_photo/opencv/220106_field.jpg" width="30%">
<br />
<b> 원본 이미지들
<br />
<img src="/assets/post_photo/opencv/220106_fieldplane1.jpg" width="50%">
<br />
마스크 씌우기</b>
</div>


### 연산 시간 측정

이미지 반전 연산 시간 비교
for문 : 504ms
단순 연산 : 0.9ms
#### 비교 1
이미지 반전을 이중 for문을 통해 실행
```
In :  src = cv2.imread('./data/lenna.bmp', cv2.IMREAD_COLOR)

      if src is None :
          print("image load failed ! ",cv2.IMREAD_COLOR)
          sys.exit()

      dst = np.empty(src.shape , dtype = src.dtype)

      tm = cv2.TickMeter()
      tm.start()

      for y in range(src.shape[0]):
          for x in range(src.shape[1]):
              dst[y , x] = 255 - src[y , x]

      tm.stop()
      print("%4.3f ms" % tm.getTimeMilli())

      cv2.imshow('src',src)
      cv2.imshow('dst',dst)

      cv2.waitKey()
      cv2.destroyAllWindows()

Out : 504.697 ms
```

#### 비교 2
이미지 반전을 numpy의 array 단순 연산으로 실행
```
In :  src = cv2.imread('./data/lenna.bmp', cv2.IMREAD_COLOR)

      if src is None :
          print("image load failed ! ",cv2.IMREAD_COLOR)
          sys.exit()

      dst = np.empty(src.shape , dtype = src.dtype)

      tm = cv2.TickMeter()
      tm.start()

      dst = 255-src

      tm.stop()
      print("%4.3f ms" % tm.getTimeMilli())

      cv2.imshow('src',src)
      cv2.imshow('dst',dst)

      cv2.waitKey()
      cv2.destroyAllWindows()

Out : 0.890 ms
```
<div style="text-align:center;">
<img src="/assets/post_photo/opencv/220106_lenna1.jpg" width="40%">
<img src="/assets/post_photo/opencv/220106_lenna2.jpg" width="40%">
</div>

### 밝기 조절

#### 함수를 구현하여 밝기 증가
```
In :  src = cv2.imread('./data/lenna.bmp', cv2.IMREAD_GRAYSCALE)

      def add(arr, value):
          arr = arr.copy().astype('uint32')+value
          arr[arr>255]=255
          arr = arr.copy().astype('uint8')
          return arr

      dst = add(src,100)

      cv2.imshow('src',src)
      cv2.imshow('dst',dst)

      cv2.waitKey()
      cv2.destroyAllWindows()
```

#### OpenCV 내장 함수를 이용한 밝기 증가
```
In :  ## cv2.add 기본 함수
      src = cv2.imread('./data/lenna.bmp', cv2.IMREAD_GRAYSCALE)
      dst = np.empty(src.shape, src.dtype)
      dst = cv2.add(src, 100)

      cv2.imshow('src',src)
      cv2.imshow('dst',dst)

      cv2.waitKey()
      cv2.destroyAllWindows()
```
<div style="text-align:center;">
<img src="/assets/post_photo/opencv/220106_lenna3.jpg" width="40%">
<img src="/assets/post_photo/opencv/220106_lenna4.jpg" width="40%">
</div>

#### 트랙바 추가하여 밝기 조절하기
```
In :  def add(arr, value):
          arr = arr.copy().astype('uint32')+value
          arr[arr>255]=255
          arr = arr.copy().astype('uint8')
          return arr

      def update(pos):
          dst = add(src, pos)
          cv2.imshow('src',dst)

      src = cv2.imread('./data/lenna.bmp', cv2.IMREAD_GRAYSCALE)

      cv2.namedWindow('src')
      cv2.createTrackbar("brightness","src",0,100,update) # 0~100
      cv2.setTrackbarPos('brightness','src',50) # 시작시 밝기 조절 50수준

      cv2.waitKey()
      cv2.destroyAllWindows()
```
<div style="text-align:center;">
<img src="/assets/post_photo/opencv/220106_lennatrack1.jpg" width="40%">
<img src="/assets/post_photo/opencv/220106_lennatrack2.jpg" width="40%">
</div>
