# 기초 사용법

[opencv site](https://opencv.org)

[opencv document](https://docs.opencv.org/4.5.5/)

[markdown document](https://www.markdownguide.org/cheat-sheet/)


```python
import cv2
```


```python
cv2.__version__
```




    '4.5.5'




```python
cv2.imread('./data/lenna.bmp')
```




    array([[[125, 137, 226],
            [125, 137, 226],
            [133, 137, 223],
            ...,
            [122, 148, 230],
            [110, 130, 221],
            [ 90,  99, 200]],
    
           [[125, 137, 226],
            [125, 137, 226],
            [133, 137, 223],
            ...,
            [122, 148, 230],
            [110, 130, 221],
            [ 90,  99, 200]],
    
           [[125, 137, 226],
            [125, 137, 226],
            [133, 137, 223],
            ...,
            [122, 148, 230],
            [110, 130, 221],
            [ 90,  99, 200]],
    
           ...,
    
           [[ 60,  18,  84],
            [ 60,  18,  84],
            [ 58,  27,  92],
            ...,
            [ 84,  73, 173],
            [ 76,  68, 172],
            [ 79,  62, 177]],
    
           [[ 57,  22,  82],
            [ 57,  22,  82],
            [ 62,  32,  96],
            ...,
            [ 79,  70, 179],
            [ 81,  71, 181],
            [ 81,  74, 185]],
    
           [[ 57,  22,  82],
            [ 57,  22,  82],
            [ 62,  32,  96],
            ...,
            [ 79,  70, 179],
            [ 81,  71, 181],
            [ 81,  74, 185]]], dtype=uint8)




```python
%pwd # 현재 경로 확인
```




    'C:\\work_opencv'




```python
img=cv2.imread('./data/lenna.bmp')

print(img.shape) # R ,G ,B  3 장

cv2.namedWindow("image" )
cv2.imshow("image",img)

# 종료조건 - 어떤 키든지 눌리면
cv2.waitKey()
cv2.destroyAllWindows()
```

    (512, 512, 3)
    

### Workshop : 영상파일 읽기 및 화면 표시
1. './data/lena.jpg' 파일을 읽어 컬러로 표시, 키보드 아무 키나 누르면 사라지도록
2. './data/lena.jpg' 파일을 읽어 흑백으로 표시, 키보드 아무 키나 누르면 사라지도록


```python
# TODO
fname = './data/lena.jpg'
origin = cv2.imread(fname, cv2.IMREAD_COLOR)
gray=cv2.imread(fname,cv2.IMREAD_GRAYSCALE)

print(gray.shape) # R ,G ,B  3 장

cv2.imshow("origin",origin)
cv2.imshow("gray",gray)

# 종료조건 - 어떤 키든지 눌리면
cv2.waitKey()
cv2.destroyAllWindows()
```

    (512, 512)
    

### Workshop : 영상 파일 저장
1. '/data/lena.bmp' 파일 읽어서 bmp 파일 형식의 './out/Lena.bmp'로 저장

2. '/data/lena.bmp' 파일 읽어서 png 파일 형식의 './out/Lena.png'로 저장

2. '/data/lena.bmp' 파일 읽어서 png 파일 형식의 './out/Lena.png'이름, 압축률 90%로 저장

2. '/data/lena.bmp' 파일 읽어서 png 파일 형식의 './out/Lena.png'이름, 압축률 50%로 저장


```python
# TODO
fname = './data/lena.jpg'
imgColor = cv2.imread(fname,cv2.IMREAD_COLOR)

cv2.imwrite('./out/Lena.png',imgColor,[cv2.IMWRITE_PNG_COMPRESSION, 9]) # 0~9 압축률
cv2.imwrite('./out/Lena.jpg',imgColor,[cv2.IMWRITE_JPEG_QUALITY, 50]) # 0~100 품질
```




    True



### Workshop : matplotlib 1 컬러영상 표시

1. openCV를 이용해 './data/lena.jpg'파일을 읽어들인 후 matplotlib.pylot의 imshow() 함수를 사용해 화면에 표시하라.
- 결과 확인
2. openCV를 이용해 './data/lena.jpg'파일을 읽어들인 후 matplotlib.pylot의 imshow() 함수를 사용해 화면에 표시하라.
- 표시된 결과가 원본과 동일한 색조가 되도록 변환 후 화면에 표시
3. openCV를 이용해 './data/lena.jpg'파일을 읽어들인 후 matplotlib.pylot의 imshow() 함수를 사용해 화면에 표시하라.
- numpy ndarray의 색인 문법으로 컬러 채널의 순서를 변경


```python
#TODO
import matplotlib.pyplot as plt
imgFile='./data/lena.jpg'
img = cv2.imread(imgFile)

plt.imshow(img)
```




    <matplotlib.image.AxesImage at 0x2d198ba9be0>




    
![png](Computer_Vision_Day1_files/Computer_Vision_Day1_14_1.png)
    



```python
imgRGB = cv2.cvtColor(img, cv2.COLOR_BGR2RGB) # BGR - RGB 순서 맞추기
plt.imshow(imgRGB)
```




    <matplotlib.image.AxesImage at 0x2d199353820>




    
![png](Computer_Vision_Day1_files/Computer_Vision_Day1_15_1.png)
    



```python
import numpy as np

imgRGB = np.zeros(img.shape, dtype='uint8') # unsigned int 
print(imgRGB.dtype)

# 512,512, 3 중에 1채널씩 바꿈
# BGR2RGB 안하고 이렇게 해도 된다.
imgRGB[:, :, 2] = img[:, :, 0] # blue channel
imgRGB[:, :, 1] = img[:, :, 1] # green channel
imgRGB[:, :, 0] = img[:, :, 2] # red channel

plt.imshow(imgRGB)
```

    uint8
    




    <matplotlib.image.AxesImage at 0x2d1993c3b20>




    
![png](Computer_Vision_Day1_files/Computer_Vision_Day1_16_2.png)
    



```python
# float 형태로 그냥 하는 법 = 255로 나눈다.
imgRGB = np.zeros(img.shape)

# 512,512, 3 중에 1채널씩 바꿈
# BGR2RGB 안하고 이렇게 해도 된다.
imgRGB[:, :, 2] = img[:, :, 0] # blue channel
imgRGB[:, :, 1] = img[:, :, 1] # green channel
imgRGB[:, :, 0] = img[:, :, 2] # red channel

imgRGB = imgRGB/255.0
plt.imshow(imgRGB)
```




    <matplotlib.image.AxesImage at 0x2d19a4c0580>




    
![png](Computer_Vision_Day1_files/Computer_Vision_Day1_17_1.png)
    


# 행렬 연산

### 행렬 : numpy ndarray


```python
import sys

img = cv2.imread('./data/cat.bmp',cv2.IMREAD_GRAYSCALE)

if img is None:
    print("image does not exist")
    sys.exit()
    
print("type(img) : ",type(img))
print("img.shape : ",img.shape)

cv2.imshow("img",img)
cv2.waitKey()
cv2.destroyAllWindows()
```

    type(img) :  <class 'numpy.ndarray'>
    img.shape :  (480, 640)
    

### 행렬의 생성과 초기화


```python

img1 = np.empty((480,640),np.uint8) # dtype='uint8' 해도 된다.
img2 = np.zeros((480,640),np.uint8)
img3 = np.ones((480,640),np.uint8)

img4 = np.full((480,640), 0, np.float32)

print(type(img1),type(img2),type(img3),type(img4))
```

    <class 'numpy.ndarray'> <class 'numpy.ndarray'> <class 'numpy.ndarray'> <class 'numpy.ndarray'>
    


```python
I = [[1,2,3,4],
     [5,6,7,8],
     [9,10,11,12]] # python list

mat = np.array(I)

print(type(img1),mat)
```

    <class 'numpy.ndarray'> [[ 1  2  3  4]
     [ 5  6  7  8]
     [ 9 10 11 12]]
    


```python
I[0][1]=100

print(I)

I[2][:]=
print(I)
```

    [[1, 100, 3, 4], [5, 6, 7, 8], [9, 10, 11, 12]]
    


    ---------------------------------------------------------------------------

    TypeError                                 Traceback (most recent call last)

    ~\AppData\Local\Temp/ipykernel_14940/4214547485.py in <module>
          3 print(I)
          4 
    ----> 5 I[2,:]=200
          6 print(I)
    

    TypeError: list indices must be integers or slices, not tuple


### 행렬의 복사


```python
img1 = cv2.imread('./data/cat.bmp')

img2 = img1
img3 = img1.copy()

img1[:,:]=(0,255,255) # yellow

cv2.imshow("img2",img2)
cv2.imshow("img3",img3)
cv2.waitKey()
cv2.destroyAllWindows()
```

    [[[191 190 170]
      [199 195 176]
      [205 201 182]
      ...
      [244 242 237]
      [244 242 237]
      [244 242 237]]
    
     [[193 192 172]
      [200 196 177]
      [207 202 183]
      ...
      [244 242 237]
      [244 242 237]
      [244 242 237]]
    
     [[194 192 172]
      [200 196 177]
      [207 203 184]
      ...
      [244 242 237]
      [244 242 237]
      [244 242 237]]
    
     ...
    
     [[  0  15  28]
      [  0  16  29]
      [  2  18  30]
      ...
      [  3  10  13]
      [  4  11  14]
      [  3  10  12]]
    
     [[  0  17  27]
      [  1  17  29]
      [  1  17  29]
      ...
      [  2  11  12]
      [  3  11  13]
      [  2  10  13]]
    
     [[  0  17  27]
      [  0  15  27]
      [  0  15  27]
      ...
      [  1  12  11]
      [  3  11  13]
      [  3  10  14]]]
    [[[  0 255 255]
      [  0 255 255]
      [  0 255 255]
      ...
      [  0 255 255]
      [  0 255 255]
      [  0 255 255]]
    
     [[  0 255 255]
      [  0 255 255]
      [  0 255 255]
      ...
      [  0 255 255]
      [  0 255 255]
      [  0 255 255]]
    
     [[  0 255 255]
      [  0 255 255]
      [  0 255 255]
      ...
      [  0 255 255]
      [  0 255 255]
      [  0 255 255]]
    
     ...
    
     [[  0 255 255]
      [  0 255 255]
      [  0 255 255]
      ...
      [  0 255 255]
      [  0 255 255]
      [  0 255 255]]
    
     [[  0 255 255]
      [  0 255 255]
      [  0 255 255]
      ...
      [  0 255 255]
      [  0 255 255]
      [  0 255 255]]
    
     [[  0 255 255]
      [  0 255 255]
      [  0 255 255]
      ...
      [  0 255 255]
      [  0 255 255]
      [  0 255 255]]]
    

### 행렬 원소값  참조


```python
np.arange(12).reshape(3,4)
```




    array([[ 0,  1,  2,  3],
           [ 4,  5,  6,  7],
           [ 8,  9, 10, 11]])




```python
mat1 = np.array(np.arange(12).reshape(3,4))

mat2 = np.zeros(mat1.shape , type(mat1))

h, w = mat1.shape

for j in range(h):
    for i in range(w):
        mat2[j,i]=mat[j,i]+10 # 더하는건 밝아진다고 보면 됨

print(mat1)
print(mat2)
```

    [[ 0  1  2  3]
     [ 4  5  6  7]
     [ 8  9 10 11]]
    [[11 12 13 14]
     [15 16 17 18]
     [19 20 21 22]]
    


```python
mat2 = mat1 + 10 # broadcasting
mat2
```




    array([[10, 11, 12, 13],
           [14, 15, 16, 17],
           [18, 19, 20, 21]])



### 행렬 연산


```python
mat1 = np.ones((3,4),np.int32)
mat2 = np.arange(12).reshape(3,4)
mat3 = mat1 + mat2
mat4 = mat2*2
print(mat3)
print(mat4)
```

    [[ 1  2  3  4]
     [ 5  6  7  8]
     [ 9 10 11 12]]
    [[ 0  2  4  6]
     [ 8 10 12 14]
     [16 18 20 22]]
    

### Workshop : 이미지 테두리 그리기
- Slicing 테스트


```python
img = plt.imread('./data/psj.png')
plt.imshow(img)
img.shape, type(img)
```




    ((333, 365, 4), numpy.ndarray)




    
![png](Computer_Vision_Day1_files/Computer_Vision_Day1_34_1.png)
    



```python
# 위
img[:5,:,0]=1
img[:5,:,1]=0
img[:5,:,2]=0

#왼
img[:,:5]=[1,0,0,1]

#오
img[:,img.shape[1]-5:]=[1,0,0,1]

#아래
img[-5:,:]=[1,0,0,1]
plt.imshow(img)
```


    ---------------------------------------------------------------------------

    ValueError                                Traceback (most recent call last)

    ~\AppData\Local\Temp/ipykernel_14940/3971049542.py in <module>
          5 
          6 #왼
    ----> 7 img[:,:5]=[1,0,0]
          8 
          9 #오
    

    ValueError: could not broadcast input array from shape (3,) into shape (333,5,4)



```python
# 이미지 색 반전, 4번 채널이 있으니 조심
img = plt.imread('./data/psj.png')
img1 = 1-img[:,:,:3]
plt.imshow(img1)
```




    <matplotlib.image.AxesImage at 0x2d19c445850>




    
![png](Computer_Vision_Day1_files/Computer_Vision_Day1_36_1.png)
    



```python
# 4번째 채널 (alpha channel)
img = plt.imread('./data/psj.png')
img[:,:,3]=0.3

plt.imshow(img)
```




    <matplotlib.image.AxesImage at 0x1afe7781880>




    
![png](Computer_Vision_Day1_files/Computer_Vision_Day1_37_1.png)
    


### 동영상 파일 다루기
- 카메라 입력
- 영상 저장


```python
cap = cv2.VideoCapture(0) # 카메라 디바이스, 동영상 파일명, 스트리밍 주소

if not cap.isOpened():
    print("Camera open failed!!")
    sys.exit()

w, h = int(cap.get(cv2.CAP_PROP_FRAME_WIDTH)), int(cap.get(cv2.CAP_PROP_FRAME_HEIGHT))
fps = cap.get(cv2.CAP_PROP_FPS)

print("frame width, height:", w, h)
print("fps : ",fps)

fourcc = cv2.VideoWriter_fourcc(*"DIVX")

outputVideo = cv2.VideoWriter('./out/output.avi', fourcc, fps, (w,h))


while True:
    ret, frame = cap.read()
    if not ret:
        break;
    
    inversed = ~frame
    
    outputVideo.write(frame)
    
    cv2.imshow("frame", frame)
    cv2.imshow("inversed", inversed)
    
    if cv2.waitKey(10) == 27: #sleep 효과
        break

if cap.isOpened():
    cap.release()
    
outputVideo.release()
cv2.destroyAllWindows()

```

    frame width, height: 640 480
    fps :  30.0
    


```python
cap = cv2.VideoCapture('./data/stopwatch.avi') # 카메라,동영상 파일명, 스트리밍 주소

if not cap.isOpened():
    print("Camera open failed!")
    sys.exit()
    
w, h = cap.get(cv2.CAP_PROP_FRAME_WIDTH), cap.get(cv2.CAP_PROP_FRAME_HEIGHT)
fps = cap.get(cv2.CAP_PROP_FPS)

print("frame width, height : ",w,h)
print("fps : ",fps)

delay = round(1000/fps) # 정수로 반올림

while True:
    ret, frame = cap.read()
    
    if not ret:
        break
        
    inversed = -frame
    cv2.imshow("frame",frame)
    cv2.imshow("inversed",inversed)
    
    # 27은 esc 키 정보?
    # waitKey( ? ) 안에는 시간 정보 ms
    if cv2.waitKey(delay) == 27:
        break

if cap.isOpened():
    cap.release()

cv2.destroyAllWindows()
```

    frame width, height :  640.0 480.0
    fps :  30.0
    


```python

```


```python

```


```python

```


```python

```


```python

```


```python

```


```python

```


```python

```
